---
sidebar_position: 2
draft: false
description: Raspberry Pi Connect是一款强大的远程访问工具，允许用户从全球任何地方安全地连接并控制他们的树莓派设备。通过安装Connect软件，用户能够访问树莓派的桌面环境或shell，实现远程操作。该工具采用加密连接，确保数据传输的安全性，并在无法直接连接时使用中继服务器。Raspberry Pi Connect支持屏幕共享和远程shell访问，提供灵活的远程管理解决方案，适合需要远程监控和管理树莓派项目的用户。
keywords: [Raspberry Pi Connect, 远程访问, 树莓派, 安全连接, 屏幕共享, 远程shell, 加密通信, 中继服务器, Raspberry Pi OS Bookworm, 设备管理]
last_update: 
  date: 2026-02-01
---
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import Normal from "../_normal.mdx";

# 树莓派 Connect

## 介绍

通过 Raspberry Pi Connect，您可以从世界任何地方安全地访问您的 Raspberry Pi。
<img src="/img/services/connect/hero.png" alt="Connect 使用示例" width="100%" />

Connect 默认安装在树莓派操作系统桌面版和树莓派操作系统完整版（含推荐软件的桌面系统）中。树莓派操作系统精简版默认安装的是 Connect 的替代版本 **Lite**，该版本仅支持远程 shell 访问，不具备屏幕共享功能。

使用 Connect 时，请参阅 [将设备与 Connect 账户关联](#将-raspberry-pi-设备与-connect-账户连接起来)。访问 [connect.raspberrypi.com](https://connect.raspberrypi.com)，即可在浏览器窗口中访问运行于树莓派上的桌面环境或 shell 终端。

Connect 使用安全的加密连接。默认情况下，Connect 会在 Raspberry Pi 和浏览器之间直接通信。但是，当 Connect 无法在 Raspberry Pi 和浏览器之间建立直接连接时，我们会使用中继服务器。在这种情况下，Raspberry Pi 只保留操作 Connect 所需的元数据。

:::tip
要使用 Connect，您的树莓派必须运行 [Raspberry Pi OS Bookworm](https://www.raspberrypi.com/news/bookworm-the-new-version-of-raspberry-pi-os/) 或更高版本。
:::

## 手动启动和停止 Connect

要从命令行启动 Connect 或 Connect Lite，请运行以下命令：

```sh
rpi-connect on
```

要停止 Connect，请运行以下命令：

```
rpi-connect off
```

## 将 Raspberry Pi 设备与 Connect 账户连接起来

在树莓派设备上启动 Connect 后，您必须将设备与 Connect 账户关联。

若您使用树莓派映像工具在设备上安装树莓派操作系统，则可能已完成设备与 Connect 账户的绑定。更多信息请参阅 [使用映像工具安装](../computers/getting-started.mdx#使用imager工具安装)。


<Tabs>
<TabItem value="desktop" label="桌面">

从菜单栏的“连接”图标中，选择**开启树莓派连接**。这将打开您的浏览器，系统会提示您使用树莓派ID登录：

<img src="/img/services/connect/browser-sign-in.png" alt="浏览器登录" width="80%" />

若您已开启Connect功能，请从下拉菜单中选择**登录...**：
<img src="/img/services/connect/sign-in.png" alt="登录" width="80%" />

若您尚未拥有树莓派ID，请选择*免费创建*以[创建一个](./id.mdx#创建一个-raspberry-pi-id)。

</TabItem>
<TabItem value="cli" label="终端">

使用以下命令生成一个链接，将设备连接到 Connect 帐户：

```sh
rpi-connect signin
```

此命令将输出类似以下内容：

```
Complete sign in by visiting https://connect.raspberrypi.com/verify/XXXX-XXXX
```

要将您的设备与Connect账户关联，请在任意设备上访问验证网址，并使用您的树莓派ID登录。

</TabItem>

<TabItem value="authkey" label="使用授权密钥">
授权密钥是一种一次性临时令牌，可让您自动将设备与Connect账户关联（无需使用网页界面）。

创建和使用授权密钥最便捷的方式是通过 Imager 中的自定义选项实现。您也可通过个人或组织Connect账户的**设置**页面手动创建授权密钥，组织管理员还可使用[管理API](#管理api)创建授权密钥。

:::tip
个人账户每次仅能激活一个授权密钥；组织账户可同时激活多个授权密钥。每台设备需使用独立的授权密钥。
:::

tip:
Raspberry Pi Connect 网站会显示认证密钥的有效期。使用前请确保在到期前启动树莓派并连接网络。
:::

创建认证密钥后，可通过 `rpi-connect signin` 命令提供给设备，或将其写入用户主目录的文件中。

若以字符串形式提供密钥，请执行以下命令：
```sh
rpi-connect signin --auth-key=rpuak_123456
```

若将密钥保存至文件，可通过在路径前添加 `@` 符号传递完整路径：

```sh
rpi-connect signin --auth-key=@/home/alice/auth.key
```

若将认证密钥保存至用户主目录下的 `.config/com.raspberrypi.connect/auth.key`，Connect 将自动检测到该文件。

</TabItem>
</Tabs>

### 完成连接您的 Raspberry Pi

完成身份验证后，为您的设备命名。请选择一个能唯一标识该设备的名称。

<img src="/img/services/connect/new-device.png" alt="新设备" width="80%" />

若您是 [组织](#组织版-connect) 的管理员，请选择将此设备添加至个人账户或特定组织。

<img src="/img/services/connect/new-organisation-device.png" alt="新组织" width="80%" />

点击**创建设备并登录**按钮继续。

您现在可以远程连接至您的设备。菜单栏中的 **Connect** 图标将变为蓝色，表示您的设备已登录 **Connect** 服务。您应收到一封电子邮件通知，告知有新设备已关联至您的Connect账户。

<img src="/img/services/connect/sign-in-email.png" alt="电子邮件提示" width="70%" />

:::warning
若收到邮件提示有未知设备登录Connect，请立即更改树莓派ID密码。请按照 [从Connect移除设备](#管理设备) 中的说明操作，永久解除该设备与您账户的关联。建议启用 [启用双因素身份验证](./id.mdx#启用双因素身份验证) 以保障账户安全。
:::

通过选择菜单栏中的 **Connect** 图标打开 **Connect** 菜单。该菜单允许您开启或关闭 **Connect** 功能、进行登录或注销操作，以及允许或禁止远程访问方式。

:::tip
Connect 使用设备序列号登录通信。在设备之间移动 SD 卡将会退出 Connect。
:::

## 访问你的 Raspberry Pi 设备

现在，您的设备已显示在 Connect 控制面板上，您只需使用浏览器即可随时随地访问您的设备。Connect 提供多种远程与设备交互的方式。

### 屏幕共享

Connect 包括在浏览器中共享设备屏幕的功能。使用以下说明共享设备屏幕。

:::tip
屏幕共享需要**Wayland**窗口服务器。Raspberry Pi OS _Bookworm_ 及其后续版本默认使用 Wayland。屏幕共享与 Raspberry Pi OS Lite 或使用 X 窗口服务器的系统**不兼容**。
:::

在任何电脑上访问 [connect.raspberrypi.com](https://connect.raspberrypi.com)。

Connect 会将您重定向到 Raspberry Pi ID 服务以登录。登录后，Connect 会显示链接设备的列表。可进行屏幕共享的设备名称下方会显示一个灰色的**Screen sharing**徽章。
<img src="/img/services/connect/devices.png" alt="列出设备" width="80%" />

选择您要访问的设备右侧的**Connect via**按钮。从菜单中选择**Screen sharing**选项。这将打开一个浏览器窗口，显示您设备的桌面。
<img src="/img/services/connect/waiting-for-screen-sharing.png" alt="等待屏幕共享" width="80%" />

现在你可以像在本地一样使用设备了。有关连接的更多信息，请将鼠标悬停在**Disconnect**按钮右侧的挂锁图标上。
<img src="/img/services/connect/screen-sharing.png" alt="屏幕共享中" width="80%" />

:::tip
使用桌面上方的**Copy from remote**和**Paste to remote**按钮，在本地和远程剪贴板之间传输文本。
:::

连接后，连接仪表板中的**Screen sharing**徽章旁边会出现一个绿点。这表示正在进行屏幕共享会话。鼠标悬停可查看当前屏幕共享会话的数量。
<img src="/img/services/connect/screen-sharing-in-progress.png" alt="屏幕共享进行中" width="80%" />

系统托盘中的 **Connect** 图标在屏幕共享会话进行时会旋转。每次屏幕共享会话开始时，都会出现桌面通知。
<img src="/img/services/connect/screen-sharing-notification.png" alt="屏幕共享通知" width="80%" />

#### 禁止屏幕共享

要关闭屏幕共享会话，请选择桌面上方的**Disconnect**按钮。
<img src="/img/services/connect/screen-sharing-ended.png" alt="结束屏幕共享" width="80%" />

#### 禁止屏幕共享

要关闭屏幕共享功能，请在菜单栏中选择 Connect 图标，然后取消勾选 **允许屏幕共享**。您的设备仍保持登录 Connect 的状态，但无法通过 Connect 控制面板创建屏幕共享会话。

<img src="/img/services/connect/disallow-screen-sharing.png" alt="禁止屏幕共享" width="80%" />

您也可以使用以下命令禁止屏幕共享：

```sh
rpi-connect vnc off
```

在连接仪表板中，**Screen sharing**徽章和**Connect via**连接菜单中的**Screen sharing**选项将被划掉。
<img src="/img/services/connect/screen-sharing-disabled.png" alt="已禁用屏幕共享" width="80%" />

要重新启用屏幕共享，请执行以下操作之一：

- 在菜单栏中选择 Connect 图标，然后选择**允许屏幕共享**
- 运行以下命令

```sh
rpi-connect vnc on
```

### 远程shell

Connect 包括从浏览器启动在设备上运行的 shell 的功能。使用以下说明访问远程 shell。

在任何计算机上访问 [connect.raspberrypi.com](https://connect.raspberrypi.com)。

Connect 会将你重定向到 Raspberry Pi ID 服务以登录。登录后，Connect 会显示链接设备的列表。可用于远程 shell 访问的设备会在设备名称下方显示一个灰色的 **Remote shell** 徽标。
<img src="/img/services/connect/devices.png" alt="列出设备" width="80%" />

选择要访问的设备右侧的 **Connect via** 按钮。从菜单中选择 **Remote shell** 选项。这将在设备上打开一个 shell 会话。
<img src="/img/services/connect/waiting-for-remote-shell.png" alt="等待远程shell连接" width="80%" />

现在您可以像在本地一样使用设备了。
<img src="/img/services/connect/remote-shell.png" alt="远程shell" width="80%" />

:::tip
在某些操作系统上，浏览器会拦截**Ctrl+Shift+C**和**Ctrl+C**等组合键。相反，您可以使用右键菜单或**Ctrl+Insert**来复制，**Shift+Insert**来粘贴。
:::

连接后，连接仪表板中的**Remote shell**徽章旁边会出现一个绿点。这表示远程 shell 会话处于活动状态。鼠标悬停可查看当前远程 shell 会话的数量。
<img src="/img/services/connect/remote-shell-in-progress.png" alt="远程shell激活" width="80%" />

:::tip
每个远程 shell 连接都会创建一个全新的连接，就像 SSH 一样。要在多个会话中持续执行后台命令和配置，请使用 `screen` 或 `tmux`。
:::

菜单栏中的 **Connect** 图标在远程shell会话进行时会旋转。每次启动远程shell会话时，都会出现桌面通知。
<img src="/img/services/connect/remote-shell-notification.png" alt="远程shell提示" width="80%" />

:::tip
`CONNECT_TTY` 环境变量表示会话使用 Connect 提供的远程 shell。
:::

#### 结束远程shell会话

要关闭远程 shell 会话，请运行 `exit` 命令或关闭窗口。
<img src="/img/services/connect/remote-shell-ended.png" alt="结束远程shell" width="80%" />

#### 禁止远程shell访问
要关闭远程shell访问功能，请在菜单栏中选择 Connect 图标，然后取消勾选**允许远程shell访问**选项。您的设备仍将保持登录Connect的状态，但无法通过Connect控制面板创建远程shell会话。
<img src="/img/services/connect/disallow-remote-shell.png" alt="禁用远程shell" width="80%" />

或者，也可以使用以下命令禁止远程 shell 访问：

```sh
rpi-connect shell off
```

在 Connect 面板中，**Remote shell** 徽标和**Connect via** 菜单中的**Remote shell** 选项将被划掉。
<img src="/img/services/connect/remote-shell-disabled.png" alt="已禁用远程shell" width="80%" />

要重新启用远程 shell 访问，请执行以下操作之一

- 单击 "连接 "系统托盘图标并选择**Allow Remote Shell Access**
- 运行以下命令

```sh
rpi-connect shell on
```

## 始终启用远程shell

Connect 以用户级服务而非 root 运行。因此，只有当你的用户账户当前登录设备时，Connect 才能工作。如果在禁用自动登录的情况下重启，这可能会导致无法访问设备。要在未登录设备时继续运行 Connect，请启用**user-lingering**。从您的用户账户运行以下命令启用用户登录：

```sh
loginctl enable-linger
```

:::tip
我们建议在所有无头 Raspberry Pi OS Lite 设置中启用用户登录，以防止远程重启后无法访问设备。
:::

## 禁用动画图标

若要在屏幕共享或远程shell会话进行时禁用动画图标，请右键点击菜单栏中的 Connect 图标，选择**配置插件...**。
<img src="/img/services/connect/configure-plugin.png" alt="配置插件" width="80%" />

勾选**动画图标**开关即可切换为备用图标。
<img src="/img/services/connect/disable-animate-icon.png" alt="禁用动画图标" width="80%" />

屏幕共享或远程shell会话进行时，Connect图标将变为蓝色。
<img src="/img/services/connect/static-icon.png" alt="静态图标" width="80%" />

## 管理设备

Connect 面板列出了与您的 Connect 账号关联的所有设备，并显示了访问这些设备的各种方法。
<img src="/img/services/connect/devices.png" alt="列出设备" width="80%" />

选择设备名称可打开设备详细信息页面。此页面提供有关设备的低级信息。您还可以编辑设备名称或从连接中删除设备。
<img src="/img/services/connect/device.png" alt="设备明细" width="80%" />

从 Connect 中删除设备会自动退出该设备上的连接。菜单栏中的 Connect 图标会变成灰色，菜单上只提供**Sign In...**选项。

## 更新

要更新到最新版本的 Connect，请运行以下命令：

```sh
sudo apt update
sudo apt install --only-upgrade rpi-connect
```

```tip
如果安装了 Connect Lite，请将上述命令中的 `rpi-connect` 替换为 `rpi-connect-lite`。
```

## 从 Connect 中断开设备连接

在你的设备上运行以下命令退出你的 Raspberry Pi ID，这将在 Connect 屏幕上禁用你的设备：

```sh
rpi-connect signout
```

或者，点击菜单栏中的 Connect 图标，然后点击 **Sign Out**。

:::tip
要从 Connect 帐户中完全移除设备，请使用 [从 Connect 面板中移除](#管理设备)。
:::

## 卸载

运行以下命令从设备上停止并删除 Connect 软件：

```sh
sudo apt remove --purge rpi-connect
```

:::tip
如果安装了 Connect Lite，请将上述命令中的 `rpi-connect` 替换为 `rpi-connect-lite`。
:::

卸载后，设备的序列号仍与您的 Connect 账号相关联。设备仍会出现在 Connect 面板中，但不能用于远程访问。如果在同一台设备上再次安装 Connect，即使使用不同的 SD 卡，它也会重复使用 Connect 面板中现有的设备名称。

要切断设备和 Connect 账号之间的联系，请从 Connect 面板的设备列表中删除设备。 

## 组织版 Connect

**组织版 Connect** 支持多名用户共享设备访问权限。创建组织后，该组织将自动启动为期四周的免费试用。

### 创建组织

创建新组织时，请先登录您的 Raspberry Pi Connect 账户，然后点击导航菜单左上角的账户切换图标。

<img src="/img/services/connect/account-switcher.png" alt="切换组织" width="70%" />

选择**新建组织**并输入名称，点击**开始免费试用**。您的Connect账户将自动加入该组织并成为管理员。

### 邀请用户

仅管理员可邀请其他用户加入组织。邀请步骤如下：.

1. 打开页面顶部的**用户**选项卡。此处显示组织所有成员的姓名、邮箱、角色及加入日期。

    <img src="/img/services/connect/users.png" alt="用户" width="70%" />

2. 选择**邀请他人**以添加新用户。

    <img src="/img/services/connect/invite-user.png" alt="邀请用户" width="70%" />

3. 从下拉菜单选择**角色**。组织成员可选两种角色：

    * **成员**：可远程访问组织内所有设备，但无法修改组织设置。
    * **管理员**：可远程访问组织内所有设备并修改组织设置。该角色还将接收涉及敏感操作的全局通知邮件，例如新增设备或管理API访问令牌。

4. 输入您要发送邀请的邮箱地址。

5. 选择**发送邀请**。

被邀请者无需使用该邮箱登录，可通过任意有效树莓派ID加入。

### 将树莓派设备关联至组织

仅管理员可将设备关联至组织。操作步骤：

* 若设备未关联Connect账户，请参阅 [将树莓派设备关联至Connect账户](#将-raspberry-pi-设备与-connect-账户连接起来)。

* 若设备已关联Connect账户，请参阅 [转移设备](#转移设备)。

### 转移设备

您必须是管理员才能在账户间转移设备。操作步骤如下：

1. 点击导航菜单左上角的账户切换图标。

    <img src="/img/services/connect/account-switcher-with-organisation.png" alt="更换组织" width="70%" />

2. 切换至当前拥有该设备的账户（个人账户或组织账户）。.

3. 选择需要转移的设备。.

4. 在设备页面右上角打开**设置**下拉菜单。

5. 选择**转移...**

    <img src="/img/services/connect/transfer.png" alt="转移" width="70%" />

6. 选择目标接收账户。

7. 点击**转移**。

### 设置订阅服务

组织版Connect订阅将在四周试用期结束后自动生效，此后按月延后计费。

仅管理员可设置订阅。操作步骤：

1. 点击页面顶部标签栏下方试用横幅中的**设置计费**.
2. 输入用于接收账单通知（如发票）的邮箱地址.
3. 填写支付方式信息并提交
    * 若试用期未结束，按钮显示为**开始试用** 试用期将延续，之后按月计费。
    * 若试用期已结束，按钮显示为**支付并订阅**。此操作将启动月度订阅。

免费试用结束后，若未设置订阅，您将无法远程访问组织内的设备。

    <img src="/img/services/connect/billing.png" alt="付款" width="70%" />

### 查看审计日志

审计日志按时间顺序显示过去90天内的所有活动，最新事件优先显示。事件包括设备变更、组织成员变更、API访问令牌变更以及远程访问会话等。超过90天的事件将自动删除。

仅管理员可查看组织过去90天的活动记录。要查看审计日志，请打开页面顶部的**审计日志**选项卡。

<img src="/img/services/connect/audit-log.png" alt="审计日志" width="70%" />

列表中的每个事件包含以下信息：

* **时间戳**： 事件发生的时间。
* **来源**：事件发生于仪表板还是通过API触发。
* **操作**：具体操作（例如**API访问令牌创建**）及相关细节。
* **对象**：操作涉及的对象，如特定设备、组织或访问令牌。
* **执行者**：执行事件的用户，包含事件发生所在国家/地区。

您可按操作类型（如**远程shell会话启动**）筛选事件。筛选列表时，请点击列表左上角**筛选器**旁的**操作**下拉菜单。

点击列表右上角的**下载CSV**即可下载事件列表的CSV格式文件。

### 修改组织设置

组织管理员可在页面顶部的**设置**选项卡中配置以下内容。

<img src="/img/services/connect/organisation-settings.png" alt="组织设置" width="70%" />

#### 重命名组织

若需更改组织名称，请在**常规**部分输入新名称。此操作不会影响您的设备或组织成员。

#### 创建授权密钥

若需通过 [Connect 自动关联设备](#将-raspberry-pi-设备与-connect-账户连接起来)（无需网页界面）进行操作，请创建授权密钥。在**授权密钥**区域选择**新建**，填写描述及有效期（以天为单位）。

新认证密钥将显示。点击其旁的剪贴板图标即可复制。请立即复制此密钥，后续将无法再次查看。

重要提示：认证密钥仅显示一次。请立即复制，后续将无法再次查看。

#### 创建管理API访问令牌

若需自动生成授权密钥（无需网页界面）以 [连接设备至Connect](#将-raspberry-pi-设备与-connect-账户连接起来)，可创建 [Connect for Organisations管理API](#管理api) 的API访问令牌。在**API访问令牌**区域选择**新建**，并输入令牌描述。

新访问令牌将显示。点击其旁的剪贴板图标进行复制。请立即复制此令牌，后续将无法再次查看。

重要提示：访问令牌仅显示一次。请立即复制，后续将无法再次查看。

### 管理API

管理API支持您无需Connect网页界面即可自动管理组织。向管理API发送请求时，必须使用有效的管理API访问令牌进行身份验证。基础URL为 https://api.connect.raspberrypi.com。

#### 创建授权密钥

若需自动生成 [通过Connect连接设备](#将-raspberry-pi-设备与-connect-账户连接起来) 的授权密钥，请使用 [管理API访问令牌](#创建管理api访问令牌) 发起以下HTTP请求。

请替换下方代码中的参数：

* `rporg_accesstokenhere`：您的管理API访问令牌
* `my-auth-key`：认证密钥描述
* `1`：认证密钥有效期天数（可选，默认1天）

<Tabs>
<TabItem value="http" label="HTTP">

HTTP请求：
+
```http
POST /organisation/auth-keys HTTP/1.1
Host: api.connect.raspberrypi.com
Authorization: Bearer rporg_accesstokenhere
Content-Type: application/x-www-form-urlencoded

description=my-auth-key&ttl_days=1
```

</TabItem>
<TabItem value="curl" label="curl">

```sh
curl --header ‘Authorization: Bearer rporg_accesstokenhere’ --data-urlencode ‘description=my-auth-key’ --data-urlencode ‘ttl_days=1’ https://api.connect.raspberrypi.com/organisation/auth-keys
```

</TabItem>

</Tabs>

若成功，将返回**201 Created**响应，其中包含JSON格式的授权密钥。例如：

```http
HTTP/2 201
Content-Type: application/json; charset=utf-8

{"id":"12345","description":"my-auth-key","secret":"rpoak_123456","expires_at":"2025-01-01T00:00:30Z"}
```

响应包含以下字段：

**id**：认证密钥的唯一标识符。
**description**：创建认证密钥时使用的描述信息。
**secret**：以 `rpoak_` 为前缀的随机令牌。
**expires_at**：密钥过期日期与时间（ISO 8601格式）。

在过期前可使用 `secret` 进行 [设备与Connect的关联](#将-raspberry-pi-设备与-connect-账户连接起来)。

若管理API访问令牌无效，将返回**401 未授权**响应。

若认证密钥创建失败，将返回**422 内容不可处理**响应。

```http
HTTP/2 422
Content-Type: application/json; charset=utf-8

{“message”:“验证失败：描述字段不能为空”}
```

:::tip
您也可手动在组织的**设置**页面[创建授权密钥](./connect.mdx#创建授权密钥-1)。
:::

#### 列出设备

若需列出组织中的所有设备，请使用 [管理API访问令牌](#创建管理api访问令牌) 发起以下HTTP请求。

请替换下方代码中的参数：

* `rporg_accesstokenhere`：您的管理API访问令牌

<Tabs>
<TabItem value="http" label="HTTP">

```http
GET /organisation/devices HTTP/1.1
Host: api.connect.raspberrypi.com
Authorization: Bearer rporg_accesstokenhere
```

</TabItem>
<TabItem value="curl" label="curl">

```sh
curl --header 'Authorization: Bearer rporg_accesstokenhere' https://api.connect.raspberrypi.com/organisation/devices
```

</TabItem>

</Tabs>

若成功，将返回**200 OK**响应，其中包含最多100个按名称字母顺序排列的组织设备，采用JSON格式。例如：

```http
HTTP/2 200
Content-Type: application/json; charset=utf-8

{
    "devices": [
        {
            "id": "69739b44-ebb2-468e-9e24-08126dec4925",
            "name": "raspberrypi5",
            "serial_number": "ea636879c4d47a37"
        }
    ],
    "meta": {
        "page": 1,
        "per_page": 100,
        "total_count": 1,
        "total_pages": 1
    }
}
```

响应包含以下字段：

**devices**：组织中的设备列表（每页最多100个）。
**meta**：分页详情。

`devices` 列表中的每个项目包含以下字段：

**id**：设备的唯一标识符。
**name**：设备名称。
**serial_number**：设备序列号。

`meta` 对象包含以下字段：

**page**：响应的当前页码。
**per_page**：每页的最大设备数。
**total_count**：组织中的设备总数。
**total_pages**：组织设备的总页数。

若管理API访问令牌无效，将返回**401 未授权**响应。

要获取后续页面的设备，请在查询字符串中使用 `page` 参数：

<Tabs>
<TabItem value="http" label="HTTP">

```http
GET /organisation/devices?page=2 HTTP/1.1
Host: api.connect.raspberrypi.com
Authorization: Bearer rporg_accesstokenhere
```

</TabItem>
<TabItem value="curl" label="curl">

```sh
curl --header 'Authorization: Bearer rporg_accesstokenhere' 'https://api.connect.raspberrypi.com/organisation/devices?page=2'
```

</TabItem>

</Tabs>

#### 删除设备

若需删除组织中的设备并将其从Raspberry Pi Connect注销，请使用 [管理API访问令牌](#创建管理api访问令牌) 发起以下HTTP请求。

请替换下方代码中的参数：

* `rporg_accesstokenhere`：您的管理API访问令牌
* `device-id`：设备的唯一标识符

<Tabs>
<TabItem value="http" label="HTTP">

```http
DELETE /organisation/devices/device-id HTTP/1.1
Host: api.connect.raspberrypi.com
Authorization: Bearer rporg_accesstokenhere
```

</TabItem>
<TabItem value="curl" label="curl">

```sh
curl --request DELETE --header 'Authorization: Bearer rporg_accesstokenhere' https://api.connect.raspberrypi.com/organisation/devices/device-id
```

</TabItem>

</Tabs>

若成功，将返回**204 无内容**响应，响应体为空。

若管理API访问令牌无效，将返回**401 未授权**响应。

若在组织中未找到给定的设备ID，将返回**404 未找到**响应。

## 故障排除

### 已知问题

* Connect 仅支持共享 Raspberry Pi 的单个主显示屏。当 Raspberry Pi 连接到多个 HDMI 屏幕时，Connect 有时会共享副屏幕的内容。您可以右键单击桌面，在 **桌面偏好设置...** 中更改任务栏的位置来解决这个问题。

* Connect 不支持屏幕键盘。要实现全部功能，请使用实体键盘。

* Connect 需要使用实现 [ECMAScript 2022](https://caniuse.com/?search=es2022) (ES13) 的浏览器，因为它使用了旧版浏览器无法使用的功能。

* 浏览器会拦截某些按键和按键组合。因此，您无法在 Connect 窗口中输入这些按键。Connect 提供了一个工具栏来模拟一些最常用的拦截键。

* 不支持使用 Connect 的远程 shell 升级 `rpi-connect` 和 `rpi-connect-lite` 。升级过程将终止所有远程 shell 会话并放弃所有连接。要在远程 shell 会话中升级 Connect，请使用 `screen` 或 `tmux` 等工具，以确保连接关闭后升级过程不会中断。

* 要从版本 1 升级到版本 2，必须先升级当前安装的软件包，然后再在 `rpi-connect` 和 `rpi-connect-lite` 之间切换。这将确保 Connect 服务正确迁移到版本 2 格式。如果您当前安装了 `rpi-connect`，请运行以下命令：

```sh
sudo apt install --only-upgrade rpi-connect
```

或者，如果您当前安装了 `rpi-connect-lite` ，请运行以下命令：

```sh
sudo apt install --only-upgrade rpi-connect-lite
```

在升级过程中，您应该会看到类似下面的输出，表明 Connect 的服务已迁移到版本 2 格式：

```
Replacing globally-enabled rpi-connect services with user-enabled ones...
```

### 常见问题

#### 屏幕共享不可用

如果 Connect 提示屏幕共享不可用，则表明不符合屏幕共享支持的一个或多个要求。为帮助调试问题，`rpi-connect` 和 `rpi-connect-lite` 包含`doctor`命令。使用 `rpi-connect doctor` 找出屏幕共享的问题。

运行以下命令

```sh
rpi-connect doctor
```

如果一切正常，您应该会看到类似下面的输出：

```
Screen sharing is supported by this version of rpi-connect（此版本的 rpi-connect 支持屏幕共享）
✓ Wayland compositor available （Wayland 合成器可用）
✓ Screen sharing services enabled and active （屏幕共享服务已启用并处于活动状态）
✓ Communication with Raspberry Pi Connect WebSocket server （与 Raspberry Pi Connect WebSocket 服务器通信）
✓ Communication with Raspberry Pi Connect API （与 Raspberry Pi Connect API 通信）
✓ Authentication with Raspberry Pi Connect API （使用 Raspberry Pi Connect API 进行身份验证）
✓ Peer-to-peer connection candidate via STUN （通过 STUN 候选点对点连接）
✓ Peer-to-peer connection candidate via TURN （通过 TURN 进行点对点连接的候选程序）
```

如果出现问题，您将看到类似下面的内容：

```
Screen sharing is supported by this version of rpi-connect （此版本的 rpi-connect 支持屏幕共享）
✓ Wayland compositor available （可用的 Wayland 合成器）
✗ Screen sharing services enabled and active - Please run rpi-connect on to enable and start all required services （屏幕共享服务已启用并处于活动状态 - 请运行 rpi-connect 以启用并启动所有必需的服务）
✓ Communication with Raspberry Pi Connect WebSocket server （与 Raspberry Pi Connect WebSocket 服务器通信）
✓ Communication with Raspberry Pi Connect API （与 Raspberry Pi Connect API 通信）
✓ Authentication with Raspberry Pi Connect API （使用 Raspberry Pi Connect API 进行身份验证）
✓ Peer-to-peer connection candidate via STUN （通过 STUN 候选点对点连接）
✓ Peer-to-peer connection candidate via TURN （通过 TURN 进行点对点连接的候选程序）

✗ Some checks failed （某些检查失败）
```

如果在尝试运行 Connect 所需服务时反复出现问题，请运行以下命令详细检查它们的状态：

```sh
systemctl --user status rpi-connect-wayvnc.service
journalctl --follow --user-unit rpi-connect-wayvnc.service
```

如果服务无法启动或不存在，请确保您的环境符合以下条件：

* 使用 `rpi-connect` 1.1.0 或更高版本。
* 未使用不支持屏幕共享的 `rpi-connect-lite`。
* 您使用的是 Wayland 合成器，如 wayfire 或 labwc，而非 X。您可以通过 `raspi-config` 的高级选项控制此设置。
* 使用 WayVNC 支持的桌面环境，如 Raspberry Pi Desktop。例如，使用 KDE 会将 Wayland 合成器切换为 kwin，而后者是不支持的。
* 您有一个活动的图形桌面会话，与您登录的用户相同。对于大多数人来说，这意味着要通过 ``raspi-config`` 的系统选项启用 **Desktop Autologin**。

#### 重启或结束 SSH 会话后无法连接

Connect 以用户级服务的形式运行，因此只有在用户登录服务的会话处于活动状态时才能使用。如果您希望在不运行另一个登录会话的情况下进行远程 shell 访问，请为您的用户使用 [启用用户登录](#始终启用远程shell)，这将使 Connect 始终处于运行状态。

对于屏幕共享，Connect 只能共享现有的图形桌面会话：不能创建全新的会话。必须已经有一个正在进行的桌面会话。要在启动时自动启动此类会话，请通过 `raspi-config` 的系统选项启用桌面自动登录。

#### 网络和防火墙问题

Connect 设备之间的通信通常不需要更改网络或防火墙。不过，限制性特别强的网络有时会阻止 Connect 通信。为帮助调试此类网络问题，`rpi-connect` 和 `rpi-connect-lite` 包含`rpi-connect doctor` 命令。`rpi-connect doctor` 会运行一系列测试，以检查 Connect 通信是否在网络上正常运行。

要在设备上运行这些测试，请运行以下命令：

```sh
rpi-connect doctor
```

如果 Connect 可以在网络上正常通信，您应该可以看到类似下面的输出：

```
Screen sharing is supported by this version of rpi-connect
✓ Wayland compositor available
✓ Screen sharing services enabled and active
✓ Communication with Raspberry Pi Connect WebSocket server
✓ Communication with Raspberry Pi Connect API
✓ Authentication with Raspberry Pi Connect API
✓ Peer-to-peer connection candidate via STUN
✓ Peer-to-peer connection candidate via TURN
```

如果 Connect 无法在您的网络上正常通信，您会在失败的测试用例旁边看到一个 "x" 而不是复选框。请您的网络管理员在您的网络上启用以下连接：

* 通过 `api.connect.raspberrypi.com` 与 `ws.connect.raspberrypi.com` 的 443 端口向 Raspberry Pi Connect API 与 WebSocket 服务 发送 HTTPS 请求
* 通过以下所有 UDP 端口 3478 向 Raspberry Pi Connect STUN 或 TURN 服务器发出请求：
  * `stun.raspberrypi.com`
  * `turn1.raspberrypi.com`
  * `turn2.raspberrypi.com`
  * `turn3.raspberrypi.com`
* 向下列所有 TCP 端口 3478 或 443 上的 Raspberry Pi Connect TURN 服务器发出请求：
  * `turn1.raspberrypi.com`
  * `turn2.raspberrypi.com`
  * `turn3.raspberrypi.com`
* 通过 UDP 端口 3478、443 或 49152 -> 65535 向树莓派连接 TURN 服务器发出以下所有请求：
  * `turn1.raspberrypi.com`
  * `turn2.raspberrypi.com`
  * `turn3.raspberrypi.com`

### 查看连接状态

要查看 Connect 服务的当前状态，请运行以下命令：

```sh
rpi-connect status
```

您应该会看到与下面类似的输出：

```
Signed in: yes
Subscribed to events: yes
Screen sharing: allowed (0 sessions active)
Remote shell: allowed (0 sessions active)
```

此命令的输出会显示您当前是否已登录 Connect，以及 Raspberry Pi 上已启用的远程服务。

如果看到的输出包括 "Raspberry Pi Connect is not running, run rpi-connect on"（Raspberry Pi 连接未运行，请运行 rpi-connect on），请运行 `rpi-connect on` 启动连接。

### 启用增强日志记录

你可以启用 `rpi-connect` 及其专用 WayVNC 服务器的调试日志，以详细记录 Raspberry Pi 上的本地操作。

#### 在`rpi-connect`中启用增强日志功能

将环境变量 `RPI_CONNECT_VERBOSE=1` 添加到 `/etc/default/rpi-connect`，然后使用以下命令重启Connect：

```sh
rpi-connect restart
```

或者，对于2.7之前的版本，使用以下命令覆盖 `rpi-connect` 服务定义：

```sh
systemctl --user edit rpi-connect
```

在注释之间输入以下配置行：

```sh
[Service]
ExecStart=
ExecStart=/usr/bin/rpi-connectd -socket %t/rpi-connect-wayvnc.sock -v
```

:::tip
您需要**以 "ExecStart="开头的两**行。
:::

最后，使用以下命令重启 Connect：

```sh
rpi-connect restart
```

#### 在专用 wayvnc 服务器中启用增强日志记录功能

使用以下命令覆盖 `rpi-connect-wayvnc` 服务定义：

```sh
systemctl --user edit rpi-connect-wayvnc
```

在注释之间输入以下配置行（包括 `-Ldebug` 标记）：

```sh
[Service]
ExecStart=
ExecStart=/usr/bin/rpi-connect-env /usr/bin/wayvnc --config /etc/rpi-connect/wayvnc.config --render-cursor --unix-socket --socket=%t/rpi-connect-wayvnc-ctl.sock -Ldebug %t/rpi-connect-wayvnc.sock
```

:::tip
您需要**以 "ExecStart="开头** 的两行 **都需要**。
:::

最后，使用以下命令重启 Connect：

```sh
rpi-connect restart
```

### 查看 Connect 日志

要查看 Connect 服务及其专用 WayVNC 服务器的日志，请运行以下命令：

```sh
journalctl --follow --user-unit rpi-connect.service --user-unit rpi-connect-wayvnc.service
```

## 安全性

树莓派设备与用户浏览器之间的所有连接均采用[WebRTC](https://webrtc.org)协议：这与Zoom、Microsoft Teams和Google Meet所使用的实时通信技术相同。

这意味着所有屏幕共享和远程shell访问流量均通过[DTLS](https://en.wikipedia.org/wiki/Datagram_Transport_Layer_Security)在树莓派设备与用户浏览器端进行加密。我们不会（也无法）解密这些流量，确保您的数据始终保持私密性。

此外，流量主要采用点对点传输模式，即加密数据不会经过我们的基础设施。加密流量直接在您的树莓派设备与浏览器之间传输，使我们无法进行监视。

当直接点对点连接不可行时（例如网络故障），加密数据将通过我们的[TURN](https://en.wikipedia.org/wiki/Traversal_Using_Relays_around_NAT)服务器中转。这些服务器部署于伦敦和加利福尼亚，您的流量将被路由至距离最近的中继节点。我们既不持有解密密钥，也不会记录或存储这些数据。

树莓派连接API会临时存储建立点对点连接所需的IP地址和端口。所有访问该API的流量均通过[HTTP over TLS](https://en.wikipedia.org/wiki/HTTPS)加密传输，出于安全考虑仅支持TLS 1.2及更高版本协议。这确保连接信息绝不会以明文形式发送。此类元数据最多安全存储1分钟，并在连接建立后立即删除。

树莓派连接及其API与软件组件已通过[Cure53](https://cure53.de)的安全渗透测试与安全分析师评估。

有关WebRTC安全的更多细节，请参阅[《WebRTC安全研究》](https://webrtc-security.github.io/)。

针对**Connect for Organisations**客户，我们提供可追溯过去90天活动的审计日志。为保护隐私，通过IP地址进行地理定位时，我们仅存储国家代码。


<Normal />
